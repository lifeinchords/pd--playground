#N canvas 0 0 448 648 10;
#X obj 37 469 *~;
#X obj 4 469 *~;
#X obj 4 491 -~;
#X obj 148 474 *~;
#X obj 117 474 *~;
#X obj 117 496 +~;
#X obj 95 192 *~;
#X obj 64 192 *~;
#X obj 36 192 *~;
#X obj 5 192 *~;
#X obj 5 217 +~;
#X obj 93 379 *~;
#X obj 5 597 *~;
#X obj 133 439 rfft~;
#X obj 81 160 rfft~;
#X obj 5 556 rifft~;
#X obj 5 618 outlet~;
#X obj 65 379 *~;
#X obj 65 401 +~;
#X obj 92 218 -~;
#X obj 4 423 *~;
#X obj 37 424 *~;
#X obj 69 597 r window-size;
#X obj 345 576 r window-size;
#X obj 345 618 block~;
#X obj 5 345 +~ 1e-15;
#X obj 5 577 *~;
#X obj 31 577 tabreceive~ \$0-hann;
#X obj 69 618 expr 2/(3*$f1);
#X msg 345 597 set \$1 4;
#X obj 65 422 q8_rsqrt~;
#N canvas 139 105 1006 799 read-windows 0;
#X obj 18 693 *~;
#X obj 340 448 r window-size;
#X obj 156 300 f;
#X obj 102 91 r window-size;
#X obj 102 139 /;
#X obj 195 695 *~;
#X obj 156 255 bang~;
#X obj 17 551 line~;
#X obj 102 164 * 1000;
#X obj 288 224 r speed;
#X obj 178 276 r location;
#X obj 198 302 +;
#X obj 288 272 *;
#X obj 183 470 +;
#X obj 143 446 t f f;
#X msg 17 523 \$1 \, \$2 \$3;
#X obj 17 496 pack 0 0 0;
#X obj 178 371 / 1000;
#X obj 156 394 *;
#X text 188 394 reading location (samples);
#X obj 51 597 / 4;
#X obj 288 245 * 0.01;
#X floatatom 340 498 7 0 0 0 - - -;
#X obj 340 474 *;
#X obj 499 365 r transpo;
#X obj 499 387 * 0.01;
#X obj 501 408 + 69;
#X obj 502 429 mtof;
#X obj 502 451 / 440;
#X obj 375 474 t b f;
#X obj 19 719 outlet~;
#X obj 195 720 outlet~;
#X obj 218 664 tabreceive~ \$0-hann;
#X obj 803 386 r location;
#X msg 803 409 0;
#X obj 803 432 s speed;
#X obj 768 508 r speed;
#X msg 768 532 set \$1;
#X obj 768 557 s speed-set;
#X text 411 498 stretched window size (samples);
#X obj 877 507 r transpo;
#X msg 877 533 set \$1;
#X obj 877 558 s transpo-set;
#X obj 808 94 r location;
#X msg 826 278 set \$1;
#X obj 808 140 t b f;
#X obj 826 257 f;
#X obj 754 171 int;
#X obj 754 203 sel 0;
#X msg 813 174 1;
#X msg 813 197 0;
#X obj 754 228 del 300;
#X obj 826 302 s location-set;
#X obj 17 637 tabread4~ \$0-sample;
#X obj 194 637 tabread4~ \$0-sample;
#X obj 178 347 r \$0-insamprate;
#X obj 528 586 r rewind;
#X msg 528 744 \; location \$1;
#X floatatom 111 187 5 0 0 0 - - -;
#X obj 102 115 t f b;
#X obj 142 139 samplerate~;
#X obj 102 208 / 4;
#X obj 233 306 s see-loc;
#X obj 817 116 r see-loc;
#X obj 193 420 / 2;
#X obj 156 420 -;
#X text 229 417 back up 1/2 window;
#X obj 16 597 -~;
#X text 43 6 Read two windows out of the recorded sample \, one 1/4
ahead of the other. The mid point of the front window is specified
by "location". If "speed" is nonzero \, "location" automatically precesses.
;
#X obj 528 720 * -0.5;
#X text 91 587 "back" window 1/4 cycle behind "front" one;
#X text 137 205 computation period (msec) for overlap of 4;
#X text 164 186 msec in a window;
#X obj 528 666 /;
#X obj 528 691 * 1000;
#X obj 528 642 t f b;
#X obj 568 666 samplerate~;
#X obj 528 619 f;
#X msg 845 711 \; rewind bang \; speed \$1;
#X obj 845 684 r auto;
#X obj 730 685 r no-detune;
#X msg 730 707 \; detune 0;
#X text 326 275 loop to precess the location according;
#X text 325 291 to the "speed" parameter.;
#X text 611 31 if location changes \, update number box;
#X text 610 50 in main window via "location-set" \, but;
#X text 613 69 taking care to limit frequency of updates.;
#X text 756 462 reflect control changes;
#X text 756 479 in main window.;
#X text 754 344 setting location by hand;
#X text 752 362 sets speed to zero.;
#X text 760 653 misc controls;
#X text 496 527 "rewind" control takes us;
#X text 499 545 to a location depending on;
#X text 499 564 stretched window size.;
#X connect 0 0 30 0;
#X connect 1 0 23 0;
#X connect 2 0 11 0;
#X connect 2 0 18 0;
#X connect 3 0 59 0;
#X connect 4 0 8 0;
#X connect 5 0 31 0;
#X connect 6 0 2 0;
#X connect 7 0 67 0;
#X connect 7 0 54 0;
#X connect 8 0 58 0;
#X connect 8 0 61 0;
#X connect 9 0 21 0;
#X connect 10 0 2 1;
#X connect 11 0 2 1;
#X connect 11 0 62 0;
#X connect 12 0 11 1;
#X connect 13 0 16 1;
#X connect 14 0 16 0;
#X connect 14 1 13 0;
#X connect 15 0 7 0;
#X connect 16 0 15 0;
#X connect 17 0 18 1;
#X connect 18 0 65 0;
#X connect 20 0 67 1;
#X connect 21 0 12 0;
#X connect 22 0 20 0;
#X connect 22 0 13 1;
#X connect 22 0 64 0;
#X connect 22 0 77 1;
#X connect 23 0 22 0;
#X connect 24 0 25 0;
#X connect 25 0 26 0;
#X connect 26 0 27 0;
#X connect 27 0 28 0;
#X connect 28 0 29 0;
#X connect 29 0 23 0;
#X connect 29 1 23 1;
#X connect 32 0 5 1;
#X connect 32 0 0 1;
#X connect 33 0 34 0;
#X connect 34 0 35 0;
#X connect 36 0 37 0;
#X connect 37 0 38 0;
#X connect 40 0 41 0;
#X connect 41 0 42 0;
#X connect 43 0 45 0;
#X connect 44 0 52 0;
#X connect 45 0 47 0;
#X connect 45 1 46 1;
#X connect 46 0 44 0;
#X connect 47 0 48 0;
#X connect 48 0 49 0;
#X connect 48 0 51 0;
#X connect 49 0 47 1;
#X connect 50 0 47 1;
#X connect 51 0 50 0;
#X connect 51 0 46 0;
#X connect 53 0 0 0;
#X connect 54 0 5 0;
#X connect 55 0 17 0;
#X connect 56 0 77 0;
#X connect 59 0 4 0;
#X connect 59 1 60 0;
#X connect 60 0 4 1;
#X connect 61 0 16 2;
#X connect 61 0 12 1;
#X connect 63 0 45 0;
#X connect 64 0 65 1;
#X connect 65 0 14 0;
#X connect 67 0 53 0;
#X connect 69 0 57 0;
#X connect 73 0 74 0;
#X connect 74 0 69 0;
#X connect 75 0 73 0;
#X connect 75 1 76 0;
#X connect 76 0 73 1;
#X connect 77 0 75 0;
#X connect 79 0 78 0;
#X connect 80 0 81 0;
#X restore 81 139 pd read-windows;
#X obj 172 549 tabsend~ prev-imag;
#X obj 171 570 tabsend~ prev-real;
#X obj 6 7 tabreceive~ prev-real;
#X obj 37 26 tabreceive~ prev-imag;
#X obj 70 68 *~;
#X obj 44 67 *~;
#X obj 44 89 +~;
#X obj 72 111 q8_rsqrt~;
#X obj 72 90 +~ 1e-20;
#X obj 37 110 *~;
#X obj 5 109 *~;
#X obj 125 290 r lock;
#X obj 15 244 lrshift~ 1;
#X obj 10 268 lrshift~ -1;
#X obj 109 245 lrshift~ 1;
#X obj 101 269 lrshift~ -1;
#X obj 21 303 *~;
#X obj 110 311 *~;
#X obj 5 324 +~;
#X obj 93 331 +~;
#X text 184 608 'set' message to block;
#X text 195 622 allows variable size;
#X text 192 2 recall previous output amplitude;
#X text 192 15 whose phase we'll add to measured;
#X text 192 29 phase precession;
#X text 141 66 normalize (divide by the magnitude).;
#X text 140 80 The 1e-20 is to prevent overflows.;
#X text 192 112 Read two windows \, one 1/4 length;
#X text 193 126 behind the other \, of the input;
#X text 193 139 sound \, with Hann window function;
#X text 126 165 Take FT of the window in back.;
#X text 126 179 Multiply its conjugate by the;
#X text 126 193 normalized previous output. Result;
#X text 125 207 has the magnitude of the input sound.;
#X text 186 242 If "lock" is on \, add two neighboring;
#X text 187 256 complex amplitudes. The result will;
#X text 186 270 tend toward the channel with the;
#X text 185 283 strongest amplitude.;
#X text 111 361 each channel with 1e-15 so that we get a unit;
#X text 110 375 complex number even if everything was zero.;
#X text 119 346 Normalize again \, taking care to salt;
#X text 176 408 and multiply it by the unit complex;
#X text 176 467 plus the phase difference between the;
#X text 175 513 agree better with the inter-channel;
#X text 175 529 phase relationships of the input.;
#X text 176 452 phase will be previous output phase;
#X text 175 482 two analysis windows \, except that if;
#X text 177 394 Now take FT of the forward window;
#X text 176 423 number from above. Magnitude will;
#X text 176 437 be that of the forward window and;
#X text 174 497 "lock" is on \, they will be changed to;
#X connect 0 0 2 1;
#X connect 1 0 2 0;
#X connect 2 0 33 0;
#X connect 2 0 15 0;
#X connect 3 0 5 1;
#X connect 4 0 5 0;
#X connect 5 0 32 0;
#X connect 5 0 15 1;
#X connect 6 0 19 1;
#X connect 7 0 19 0;
#X connect 8 0 10 1;
#X connect 9 0 10 0;
#X connect 10 0 45 0;
#X connect 10 0 44 0;
#X connect 10 0 50 0;
#X connect 11 0 18 1;
#X connect 12 0 16 0;
#X connect 13 0 1 1;
#X connect 13 0 3 1;
#X connect 13 1 0 1;
#X connect 13 1 4 1;
#X connect 14 0 9 1;
#X connect 14 0 7 1;
#X connect 14 1 6 1;
#X connect 14 1 8 1;
#X connect 15 0 26 0;
#X connect 17 0 18 0;
#X connect 18 0 30 0;
#X connect 19 0 46 0;
#X connect 19 0 47 0;
#X connect 19 0 51 0;
#X connect 20 0 1 0;
#X connect 20 0 4 0;
#X connect 21 0 0 0;
#X connect 21 0 3 0;
#X connect 22 0 28 0;
#X connect 23 0 29 0;
#X connect 25 0 17 1;
#X connect 25 0 17 0;
#X connect 25 0 20 0;
#X connect 26 0 12 0;
#X connect 27 0 26 1;
#X connect 28 0 12 1;
#X connect 29 0 24 0;
#X connect 30 0 20 1;
#X connect 30 0 21 1;
#X connect 31 0 14 0;
#X connect 31 1 13 0;
#X connect 34 0 37 1;
#X connect 34 0 37 0;
#X connect 34 0 42 0;
#X connect 35 0 36 1;
#X connect 35 0 36 0;
#X connect 35 0 41 0;
#X connect 36 0 38 1;
#X connect 37 0 38 0;
#X connect 38 0 40 0;
#X connect 39 0 41 1;
#X connect 39 0 42 1;
#X connect 40 0 39 0;
#X connect 41 0 8 0;
#X connect 41 0 7 0;
#X connect 42 0 9 0;
#X connect 42 0 6 0;
#X connect 43 0 48 1;
#X connect 43 0 49 1;
#X connect 44 0 48 0;
#X connect 45 0 48 0;
#X connect 46 0 49 0;
#X connect 47 0 49 0;
#X connect 48 0 50 1;
#X connect 49 0 51 1;
#X connect 50 0 25 0;
#X connect 51 0 11 0;
#X connect 51 0 11 1;
#X connect 51 0 21 0;
