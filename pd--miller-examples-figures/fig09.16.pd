#N canvas 509 314 505 368 10;
#X obj 72 34 *~;
#X obj 37 314 *~;
#X obj 7 314 *~;
#X obj 6 5 rfft~;
#X obj 7 335 rifft~;
#X obj 46 34 *~;
#X obj 46 55 +~;
#X obj 47 249 /~;
#X obj 72 178 -~;
#X obj 73 201 max~ 0;
#X obj 47 270 q8_sqrt~;
#X obj 88 133 tabreceive~ \$0-mask;
#N canvas 91 250 916 478 calculate-mask 0;
#X obj 121 355 inlet~;
#X msg 367 259 0;
#X msg 367 142 0;
#X obj 236 172 float;
#X obj 290 176 + 1;
#X obj 236 120 bang~;
#X obj 236 145 spigot;
#X floatatom 407 194 0 0 0 0 - - -;
#X obj 311 384 -~;
#X obj 367 234 sel 0;
#X obj 323 419 *~;
#X obj 289 419 +~;
#X floatatom 347 289 0 0 0 0 - - -;
#X obj 236 195 t f f;
#X obj 366 89 r make-mask;
#X obj 367 117 t b f;
#X obj 407 141 /;
#X text 479 188 number of;
#X text 487 203 frames;
#X floatatom 477 142 0 0 0 0 - - -;
#X obj 476 89 r window-msec;
#X obj 477 112 / 4;
#X text 517 109 hop size (analysis;
#X text 542 125 period) in msec;
#X obj 355 384 tabreceive~ \$0-mask;
#X obj 288 444 tabsend~ \$0-mask;
#X obj 367 194 <;
#X obj 231 234 expr 1/($f1+1);
#X text 102 26 calculate a mask using N msec of background noise;
#X text 84 50 This loops;
#X text 39 330 current power (for each channel);
#X text 363 406 average the current power into the last mask to get
the new mask. The new value is weighted 1/n on the nth iteration.;
#X text 386 288 weight to average in new power to mask;
#X text 7 179 loop counting to desired;
#X text 74 195 number of frames;
#X connect 0 0 8 0;
#X connect 1 0 12 0;
#X connect 2 0 3 1;
#X connect 2 0 26 0;
#X connect 3 0 13 0;
#X connect 3 0 4 0;
#X connect 4 0 3 1;
#X connect 5 0 6 0;
#X connect 6 0 3 0;
#X connect 7 0 26 1;
#X connect 8 0 10 0;
#X connect 9 0 1 0;
#X connect 10 0 11 1;
#X connect 11 0 25 0;
#X connect 12 0 10 1;
#X connect 13 0 26 0;
#X connect 13 1 27 0;
#X connect 14 0 15 0;
#X connect 15 0 2 0;
#X connect 15 1 16 0;
#X connect 16 0 7 0;
#X connect 20 0 21 0;
#X connect 21 0 16 1;
#X connect 21 0 19 0;
#X connect 24 0 8 1;
#X connect 24 0 11 0;
#X connect 26 0 6 1;
#X connect 26 0 9 0;
#X connect 27 0 12 0;
#X restore 65 80 pd calculate-mask;
#X obj 47 223 +~ 1e-20;
#X obj 47 291 /~ 1536;
#X obj 250 257 inlet~;
#X msg 360 200 0;
#X msg 360 96 0;
#X obj 250 135 float;
#X obj 304 139 + 1;
#X obj 250 83 bang~;
#X obj 250 108 spigot;
#X floatatom 387 148 0 0 0 0 - - -;
#X obj 274 279 -~;
#X obj 360 175 sel 0;
#X obj 281 319 *~;
#X obj 252 320 +~;
#X floatatom 327 227 0 0 0 0 - - -;
#X obj 250 158 t f f;
#X obj 360 48 r make-mask;
#X obj 360 71 t b f;
#X obj 387 126 /;
#X text 413 147 number of;
#X text 416 161 frames;
#X obj 402 71 r window-msec;
#X obj 414 126 / 4;
#X obj 321 267 tabreceive~ \$0-mask;
#X obj 252 340 tabsend~ \$0-mask;
#X obj 360 148 <;
#X obj 251 199 expr 1/($f1+1);
#X text 49 4 real FT;
#X text 97 35 compute power;
#X text 97 50 (call it "s");
#X text 70 98 subpatch shown in (b);
#X text 56 339 real iFT;
#X text 100 176 power ("s") minus;
#X text 148 190 mask ("m");
#X text 120 203 force >= 0;
#X text 87 117 mask table;
#X text 112 221 protect against;
#X text 106 235 division by zero;
#X text 113 261 sqrt((s-m)/s);
#X text 110 274 (or 0 if s < m);
#X text 79 308 normalize by 2/(3N);
#X text 248 241 power;
#X text 247 230 current;
#X text 440 117 hop size;
#X text 441 131 in msec;
#X text 355 224 weight to average;
#X text 356 237 new power into mask;
#X text 316 285 average current power into;
#X text 318 299 last mask to get new mask.;
#X text 319 323 on the nth iteration.;
#X text 249 51 loop to number;
#X text 248 66 of frames;
#X text 149 6 (a);
#X text 342 12 (b);
#X obj 114 154 r mask-level;
#X obj 88 154 *~;
#X text 318 312 New value is weighted 1/n;
#X connect 0 0 6 1;
#X connect 1 0 4 1;
#X connect 2 0 4 0;
#X connect 3 0 2 0;
#X connect 3 0 5 0;
#X connect 3 0 5 1;
#X connect 3 1 1 0;
#X connect 3 1 0 0;
#X connect 3 1 0 1;
#X connect 5 0 6 0;
#X connect 6 0 8 0;
#X connect 6 0 12 0;
#X connect 6 0 13 0;
#X connect 7 0 10 0;
#X connect 8 0 9 0;
#X connect 9 0 7 0;
#X connect 10 0 14 0;
#X connect 11 0 68 0;
#X connect 13 0 7 1;
#X connect 14 0 2 1;
#X connect 14 0 1 1;
#X connect 15 0 23 0;
#X connect 16 0 27 0;
#X connect 17 0 18 1;
#X connect 17 0 38 0;
#X connect 18 0 28 0;
#X connect 18 0 19 0;
#X connect 19 0 18 1;
#X connect 20 0 21 0;
#X connect 21 0 18 0;
#X connect 22 0 38 1;
#X connect 23 0 25 0;
#X connect 24 0 16 0;
#X connect 25 0 26 1;
#X connect 26 0 37 0;
#X connect 27 0 25 1;
#X connect 28 0 38 0;
#X connect 28 1 39 0;
#X connect 29 0 30 0;
#X connect 30 0 17 0;
#X connect 30 1 31 0;
#X connect 31 0 22 0;
#X connect 34 0 35 0;
#X connect 35 0 31 1;
#X connect 36 0 23 1;
#X connect 36 0 26 0;
#X connect 38 0 21 1;
#X connect 38 0 24 0;
#X connect 39 0 27 0;
#X connect 67 0 68 1;
#X connect 68 0 8 1;
